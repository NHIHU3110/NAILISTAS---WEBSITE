<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tài khoản — Trang cá nhân</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <script src="../Login/auth.js"></script>
  <style>
    :root{
      --bg:#fbf7f1;          /* nền be rất nhạt */
      --card:#fff;           /* mặt thẻ */
      --ink:#2a2a2a;         /* chữ chính */
      --muted:#8a7f73;       /* chữ phụ */
      --line:#efe6d8;        /* viền be */
      --brand:#C59D5F;       /* điểm nhấn (vàng nâu) */
      --brand-dark:#9a7a44;
      --ring:0 0 0 3px rgba(197,157,95,.15);
    }
    html,body{height:100%}
    body{margin:0;font-family:'Montserrat',system-ui,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--ink)}
    a{color:inherit}
    html, body {
      height: 100%;
      display: flex;
      flex-direction: column;
    }
   /* ==================== HEADER ==================== */
header {
    position: sticky;
    top: 0;
    z-index: 10;
    background-color: rgba(25, 53, 225, 1);
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 40px;
    font-family: 'Montserrat', sans-serif;
  }
  
  /* NAVIGATION */
  .nav-left, .nav-right {
    display: flex;
    gap: 20px;
  }
  
  /* LOGO */
  .logo-center {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .logo-center img {
    height: 60px;
    cursor: pointer;
    transition: transform 0.4s ease;
  }
  
  .logo-center img:hover {
    transform: scale(1.1);
  }

/* Hiệu ứng hover cho link trong header */
header a {
  position: relative;
  color: #fff;
  text-decoration: none;
  font-weight: 500;
  font-size: 1rem;
  transition: color 0.3s ease;
}

/* Tạo gạch chân ẩn ban đầu */
header a::after {
  content: "";
  position: absolute;
  bottom: -4px;
  left: 50%;
  transform: translateX(-50%) scaleX(0);
  transform-origin: center;
  width: 100%;
  height: 2px;
  background-color: #ffffff; /* Hồng nhạt cho đẹp */
  transition: transform 0.3s ease;
}

/* Khi hover: đổi màu chữ và cho gạch chân trượt ra */
header a:hover {
  color: #ffffff;
}

header a:hover::after {
  transform: translateX(-50%) scaleX(1);
}

 /* ==================== FOOTER ==================== */
 footer {
    background-color: #1935E1;
    color: #fff8f0;
    padding: 40px 10%;
    text-align: center;
    animation: fadeInFooter 1s ease 0.5s both;
    font-family: 'Montserrat', sans-serif;
    margin-top: auto;
  }
  
  @keyframes fadeInFooter {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .footer-container {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 30px;
    margin-bottom: 25px;
  }
  
  .footer-section {
    flex: 1 1 250px;
  }
  
  .footer-section h3 {
    color: #ffb6c1;
    margin-bottom: 10px;
  }
  
  .footer-section a {
    color: #fff8f0;
    text-decoration: none;
  }
  
  .footer-section a:hover {
    opacity: 0.8;
  }
  
  .footer-bottom {
    border-top: 1px solid rgba(255,255,255,0.3);
    padding-top: 15px;
    font-size: 0.9rem;
  }
    main {
      flex: 1; /* chiếm hết khoảng trống giữa header và footer */
    }
    footer {
      margin-top: auto; /* đẩy footer xuống cuối */
    }

    html, body {
  height: 100%;
  display: flex;
  flex-direction: column;
}

body {
  margin: 0;
  font-family: 'Montserrat', system-ui, Segoe UI, Roboto, Helvetica, Arial;
  background: var(--bg);
  color: var(--ink);
  display: flex;
  flex-direction: column;
  justify-content: space-between;  /* Đảm bảo phần tử chính chiếm hết không gian */
}

main {
  flex: 1; /* Đảm bảo phần main chiếm hết không gian giữa header và footer */
  display: flex;
  flex-direction: column;
  justify-content: space-between; /* Đảm bảo các phần trong main đều được phân bổ hợp lý */
}

footer {
  background-color: #1935E1;
  color: #fff8f0;
  padding: 40px 10%;
  text-align: center;
  animation: fadeInFooter 1s ease 0.5s both;
  font-family: 'Montserrat', sans-serif;
  margin-top: auto; /* Đẩy footer xuống cuối */
  flex-shrink: 0; /* Đảm bảo footer không bị thu nhỏ */
}

header {
  position: sticky;
  top: 0;
  z-index: 10;
  background-color: rgba(25, 53, 225, 1);
  height: 80px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 40px;
  font-family: 'Montserrat', sans-serif;
  flex-shrink: 0; /* Đảm bảo header không bị thu nhỏ */
}


    /* ===== layout ===== */
    .container{max-width:1100px;margin:0 auto;padding:24px 16px}
    .page-title{font-size:2.1rem;font-weight:800;margin:12px 0 20px}

    /* ===== tabs ===== */
    .tabs{display:flex;gap:8px;border-bottom:1px solid var(--line);padding-bottom:8px;margin-bottom:16px}
    .tab-btn{appearance:none;border:none;background:#efe9df;color:#6e6459;padding:10px 14px;border-radius:12px 12px 0 0;font-weight:700;cursor:pointer}
    .tab-btn[aria-selected="true"]{background:var(--card);color:#000;border:1px solid var(--line);border-bottom-color:transparent}

    /* ===== card ===== */
    .card{background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:0 12px 35px rgba(0,0,0,.04);padding:18px;
    height:fit-content;width: max-content;}
    .card{background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:0 12px 35px rgba(0,0,0,.04);padding:18px;height:fit-content;}
    .card-orders{background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:0 12px 35px rgba(0,0,0,.04);padding:18px;height:fit-content}
    .card + .card{margin-top:14px}
    .card h3{margin:0 0 10px;font-size:1.05rem;color:#4a433d}

    /* ===== form ===== */
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    label{display:block;font-weight:700;font-size:.9rem;margin:4px 0}
    input[type="text"],input[type="email"],input[type="tel"],input[type="date"],select,textarea{
      width:100%;padding:12px 12px;border:1px solid var(--line);border-radius:12px;background:#fff;font:inherit;outline:none
    }
    input:focus,select:focus,textarea:focus{box-shadow:var(--ring);border-color:#e6d7bf}
    textarea{min-height:110px}

    .muted{color:var(--muted)}
    .hint{font-size:.85rem;color:var(--muted)}

    .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin-top:12px}
    .btn{border:none;background:#201a16;color:#fff;padding:10px 16px;border-radius:12px;font-weight:800;cursor:pointer}
    .btn.ghost{background:#fff;color:#201a16;border:1px solid var(--line)}
    .btn.brand{background:var(--brand)}
    .btn.brand:hover{background:var(--brand-dark)}

    /* ===== list / table ===== */
    .addr-list{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .addr{border:1px dashed var(--line);padding:14px;border-radius:14px}
    .addr .top{display:flex;justify-content:space-between;gap:8px;align-items:center;margin-bottom:6px}
    .addr .tag{font-weight:800;color:#6e6459;background:#f6efe4;border:1px solid var(--line);padding:4px 8px;border-radius:999px;font-size:.8rem}

    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{text-align:left;padding:10px 12px;font-size:.95rem}
    thead th{color:#6e6459;border-bottom:1px solid var(--line)}
    tbody tr{background:#fff;border:1px solid var(--line)}
    tbody tr td:first-child{border-radius:12px 0 0 12px}
    tbody tr td:last-child{border-radius:0 12px 12px 0}

    /* ===== header/footer (tận dụng ck.css nếu có) ===== */
    header{position:sticky;top:0;background:var(--bg);z-index:10;border-bottom:1px solid var(--line)}
    header .nav-left a{padding:14px 10px;display:inline-block}

    /* ===== responsive ===== */
    @media(max-width:980px){.row,.row-3{grid-template-columns:1fr}.addr-list{grid-template-columns:1fr}}

/* === Đảm bảo chiều cao và chiều rộng các phần tử trong các tab đều nhau === */
.card, .card-add, .card-order {
  background: var(--card);
  border: 1px solid var(--line);
  border-radius: 18px;
  box-shadow: 0 12px 35px rgba(0, 0, 0, .04);
  padding: 18px;
  height: 100%; /* Đảm bảo chiều cao chiếm hết không gian */
  width: 100%;  /* Đảm bảo chiều rộng chiếm hết không gian */
  box-sizing: border-box; /* Bao gồm padding và border trong chiều rộng và chiều cao */
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  min-height: 300px; /* Đảm bảo chiều cao tối thiểu */
  flex: 1; /* Đảm bảo phần tử chiếm hết chiều rộng và chiều cao đồng đều */
}

/* Các tab chỉ hiển thị khi chọn */
[data-panel] {
  display: none;
  width: 100%; /* Đảm bảo các tab có chiều rộng 100% */
}

/* Hiển thị tab đang được chọn */
[data-panel]:not([hidden]) {
  display: block;
}

.tabs {
  display: flex;
  gap: 8px;
  border-bottom: 1px solid var(--line);
  padding-bottom: 8px;
  margin-bottom: 16px;
  width: 100%; /* Đảm bảo các tab chiếm 100% chiều rộng */
}

.tab-btn {
  appearance: none;
  border: none;
  background: #efe9df;
  color: #6e6459;
  padding: 10px 14px;
  border-radius: 12px 12px 0 0;
  font-weight: 700;
  cursor: pointer;
  width: 100%; /* Đảm bảo các nút tab chiếm đều chiều rộng */
}

.tab-btn[aria-selected="true"] {
  background: var(--card);
  color: #000;
  border: 1px solid var(--line);
  border-bottom-color: transparent;
}

  </style>

  <script>
    // Nhẹ nhàng đọc người dùng đã đăng nhập từ localStorage (hoặc AuthUtils nếu có)
    window.AuthUtils = window.AuthUtils || {
      getCurrentUser(){
        try{ const raw = localStorage.getItem('currentUser'); return raw? JSON.parse(raw): null }catch{ return null }
      }
    }

    function currentEmail(){
      const me = (AuthUtils.getCurrentUser && AuthUtils.getCurrentUser()) || null;
      const e = me?.email || localStorage.getItem('signedInEmail') || localStorage.getItem('loginEmail');
      return e? String(e).toLowerCase(): null;
    }

    const k = (s)=>`acct:${currentEmail()||'guest'}:${s}`;

    function qs(s,root=document){return root.querySelector(s)}
    function qsa(s,root=document){return [...root.querySelectorAll(s)]}

    // ===== Tabs =====
    function switchTab(id){
      qsa('.tab-btn').forEach(b=>b.setAttribute('aria-selected', String(b.dataset.tab===id)));
      qsa('[data-panel]').forEach(p=>p.hidden = (p.dataset.panel !== id));
      localStorage.setItem('acct:lastTab', id);
    }

    // ===== Profile load/save =====
    function loadProfile(){
      const data = JSON.parse(localStorage.getItem(k('profile'))||'{}');
      qs('#email').value = (data.email || currentEmail() || '');
      qs('#fullName').value = data.fullName||'';
      qs('#dob').value = data.dob||'';
      qs('#phone').value = data.phone||'';
      qs('#gender').value = data.gender||'';
      qs('#bio').value = data.bio||'';
    }
    function saveProfile(){
      const oldEmail = currentEmail();                  
      const newEmail = qs('#email').value.trim().toLowerCase();
      const oldK = s => `acct:${oldEmail||'guest'}:${s}`;
      const profile = {
        email: newEmail,
        fullName: qs('#fullName').value.trim(),
        dob: qs('#dob').value,
        phone: qs('#phone').value.trim(),
        gender: qs('#gender').value,
        bio: qs('#bio').value.trim(),
      };
      if (newEmail && newEmail !== oldEmail) {
        const newK = s => `acct:${newEmail}:${s}`;
        const addrs  = JSON.parse(localStorage.getItem(oldK('addrs'))  || '[]');
        const orders = JSON.parse(localStorage.getItem(oldK('orders')) || '[]');
        localStorage.setItem(newK('profile'), JSON.stringify(profile));
        localStorage.setItem(newK('addrs'), JSON.stringify(addrs));
        localStorage.setItem(newK('orders'), JSON.stringify(orders));
        
        localStorage.removeItem(oldK('profile'));
        localStorage.removeItem(oldK('addrs'));
        localStorage.removeItem(oldK('orders'));
        
        localStorage.setItem('signedInEmail', newEmail);
        const me = (AuthUtils.getCurrentUser && AuthUtils.getCurrentUser()) || {};
        localStorage.setItem('currentUser', JSON.stringify({...me, email: newEmail}));
      } else {
        localStorage.setItem(oldK('profile'), JSON.stringify(profile));
      }
      toast('Đã lưu thông tin tài khoản');}


    // ===== Address book =====
    function loadAddrs(){ return JSON.parse(localStorage.getItem(k('addrs'))||'[]') }
    function saveAddrs(arr){ localStorage.setItem(k('addrs'), JSON.stringify(arr)) }
    function renderAddrs(){
      const box = qs('#addrBox');
      const arr = loadAddrs();
      box.innerHTML = '';
      if(!arr.length){ box.innerHTML = '<p class="muted">Chưa có địa chỉ. Nhấn “Thêm địa chỉ”.</p>'; return }
      arr.forEach((a,i)=>{
        const el = document.createElement('div');
        el.className='addr';
        el.innerHTML = `
          <div class="top">
            <span class="tag">${a.label||'Địa chỉ'}</span>
            <div>
              <button class="btn ghost" data-edit="${i}">Sửa</button>
              <button class="btn ghost" data-del="${i}">Xoá</button>
            </div>
          </div>
          <div class="muted">${a.name||''} • ${a.phone||''}</div>
          <div>${a.line||''}</div>
          <div class="muted">${a.note||''}</div>
        `;
        box.appendChild(el);
      });
    }

    function promptAddr(init={}){
      const name = prompt('Họ tên người nhận', init.name||'')
      if(name===null) return null;
      const phone = prompt('SĐT', init.phone||''); if(phone===null) return null;
      const line = prompt('Địa chỉ', init.line||''); if(line===null) return null;
      const note = prompt('Ghi chú', init.note||''); if(note===null) return null;
      const label = prompt('Nhãn (Nhà/Văn phòng...)', init.label||''); if(label===null) return null;
      return {name,phone,line,note,label};
    }

    // ===== Orders =====
    function loadOrders(){ return JSON.parse(localStorage.getItem(k('orders'))||'[]') }
    function renderOrders(){
      const tb = qs('#ordersBody');
      const arr = loadOrders();
      tb.innerHTML = '';
      if(!arr.length){ tb.innerHTML = '<tr><td colspan="5" class="muted">Chưa có đơn hàng.</td></tr>'; return }
      arr.forEach(o=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>#${o.code}</td><td>${o.date}</td><td>${o.items||1}</td><td>${o.total||'—'}</td><td>${o.status||'Đang xử lý'}</td>`;
        tb.appendChild(tr);
      });
    }

    // ===== tiny toast =====
    function toast(msg){
      let t = qs('#toast');
      if(!t){ t = document.createElement('div'); t.id='toast'; document.body.appendChild(t);
        Object.assign(t.style,{position:'fixed',bottom:'20px',right:'20px',background:'#201a16',color:'#fff',padding:'10px 14px',borderRadius:'12px',boxShadow:'0 10px 30px rgba(0,0,0,.2)',zIndex:9999,opacity:0,transition:'opacity .2s'});
      }
      t.textContent = msg; t.style.opacity=1; setTimeout(()=> t.style.opacity=0, 1200);
    }

    document.addEventListener('DOMContentLoaded',()=>{
      // Tabs
      qsa('.tab-btn').forEach(b=> b.addEventListener('click', ()=> switchTab(b.dataset.tab)));
      switchTab(localStorage.getItem('acct:lastTab') || 'info');

      // Profile
      loadProfile();
      qs('#saveInfo').addEventListener('click', saveProfile);

      // Change password demo
      qs('#changePwd').addEventListener('click', ()=>{
        const ok = confirm('Bạn muốn đặt lại mật khẩu? (demo)');
        if(ok) toast('Đã gửi email đặt lại mật khẩu (demo)');
      });

      // Addresses
      renderAddrs();
      qs('#addAddr').addEventListener('click', ()=>{
        const x = promptAddr(); if(!x) return; const arr = loadAddrs(); arr.unshift(x); saveAddrs(arr); renderAddrs(); toast('Đã thêm địa chỉ');
      });
      qs('#addrBox').addEventListener('click', (e)=>{
        const iDel = e.target.getAttribute('data-del');
        const iEdit = e.target.getAttribute('data-edit');
        if(iDel){ const arr = loadAddrs(); arr.splice(+iDel,1); saveAddrs(arr); renderAddrs(); toast('Đã xoá'); }
        if(iEdit){ const arr = loadAddrs(); const cur = arr[+iEdit]; const x = promptAddr(cur); if(!x) return; arr[+iEdit]=x; saveAddrs(arr); renderAddrs(); toast('Đã cập nhật'); }
      });

      // Orders (demo dữ liệu nếu trống)
      if(!loadOrders().length){
        localStorage.setItem(k('orders'), JSON.stringify([
          {code:'1023', date:'2025-10-14', items:2, total:'299.000đ', status:'Hoàn tất'},
          {code:'0988', date:'2025-10-05', items:1, total:'159.000đ', status:'Đang giao'},
        ]));
      }
      renderOrders();
    })
  </script>
</head>
<body>
  <div id="transition-overlay"><img src="../images/nail logo-01.png" alt="Logo chuyển trang"></div>

  <header style="background-color: #1935E1;">
    <div class="nav-left">
      <a href="../Blog/Blog.html" data-transition>Blog</a>
      <a href="../Booking/Booking.html" data-transition>Đặt lịch</a>
      <a href="Product.html" data-transition>Sản phẩm</a>
      <a href="../Service/service.html" data-transition>Dịch vụ</a>
    </div>
  
    <div class="logo-center">
      <img src="../images/nail logo-01.png" alt="Logo Nailistas" onclick="goHome()">
    </div>
  
    <div class="nav-right">
      <a href="../contact/contact.html" data-transition>Liên hệ</a>
      <a href="Login.html" data-transition>Đăng nhập</a>
      <a href="../Personal/personal.html" data-transition>Tài khoản</a>
      <a href="../Cart/cart.html" data-transition>Giỏ hàng</a>
    </div>
  </header>

  <main class="container">
    <div class="page-title">Tài khoản</div>

    <!-- Tabs -->
    <div class="tabs" role="tablist">
      <button class="tab-btn" data-tab="info" aria-selected="true" role="tab">Thông tin tài khoản</button>
      <button class="tab-btn" data-tab="addr" role="tab">Danh sách địa chỉ</button>
      <button class="tab-btn" data-tab="orders" role="tab">Lịch sử mua hàng</button>
    </div>

    <!-- Panel: Info -->
    <section class="card" data-panel="info" role="tabpanel">
      <h3>Thông tin tài khoản</h3>
      <p class="hint">Email dùng để đăng nhập. Bạn có thể cập nhật thông tin cá nhân bên dưới.</p>
      <div class="row">
        <div>
          <label for="email">Email</label>
          <input id="email" type="email">
        </div>
        <div>
          <label>&nbsp;</label>
          <button class="btn ghost" id="changePwd">Đổi mật khẩu</button>
        </div>
      </div>

      <h3 style="margin-top:16px">Thông tin cá nhân</h3>
      <div class="row-3">
        <div>
          <label for="fullName">Họ và tên</label>
          <input id="fullName" type="text" placeholder="Nguyễn Văn A">
        </div>
        <div>
          <label for="dob">Ngày sinh</label>
          <input id="dob" type="date">
        </div>
        <div>
          <label for="gender">Giới tính</label>
          <select id="gender">
            <option value="">— Chọn giới tính —</option>
            <option value="female">Nữ</option>
            <option value="male">Nam</option>
            <option value="other">Khác</option>
          </select>
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <div>
          <label for="phone">Số điện thoại</label>
          <input id="phone" type="tel" placeholder="0909 888 777">
        </div>
        <div>
          <label for="bio">Giới thiệu</label>
          <input id="bio" type="text" placeholder="Sở thích, lưu ý dịch vụ...">
        </div>
      </div>
      <div class="actions">
        <button class="btn brand" id="saveInfo">Lưu thay đổi</button>
      </div>
    </section>

    <!-- Panel: Address -->
    <section class="card-add" data-panel="addr" role="tabpanel" hidden>
      <h3>Địa chỉ nhận hàng</h3>
      <div id="addrBox" class="addr-list"></div>
      <div class="actions"><button class="btn brand" id="addAddr">Thêm địa chỉ</button></div>
    </section>

    <!-- Panel: Orders -->
    <section class="card-order" data-panel="orders" role="tabpanel" hidden>
      <h3>Lịch sử mua hàng</h3>
      <div style="overflow:auto">
        <table>
          <thead>
            <tr><th>Mã đơn</th><th>Ngày</th><th>Mặt hàng</th><th>Tổng</th><th>Trạng thái</th></tr>
          </thead>
          <tbody id="ordersBody"></tbody>
        </table>
      </div>
    </section>
  </main>
  <footer>
    <div class="footer-container">
      <div class="footer-section"><h3>Hệ thống chi nhánh</h3><p>📍 12 Nguyễn Huệ, Quận 1, TP.HCM</p><p>📍 25 Lý Thường Kiệt, Hà Nội</p><p>📍 08 Bạch Đằng, Đà Nẵng</p></div>
      <div class="footer-section"><h3>Liên hệ</h3><p>📞 Hotline: <strong>0909 888 777</strong></p><p>📧 Email: <a href="mailto:contact@nailistas.vn">contact@nailistas.vn</a></p></div>
      <div class="footer-section"><h3>Chính sách</h3><p><a href="#">Chính sách bảo mật</a></p><p><a href="#">Điều khoản dịch vụ</a></p></div>
    </div>
    <hr>
    <p>&copy; Nailistas Việt Nam</p>
  </footer>

  <script src="../Homepage/ck.js"></script>
</body>
</html>
